> Note: "Token Vault" for App Service is in Private Preview, and can be accessed by contacting our team, and completing the onboarding process under NDA. Private Preview features like "Token Vault" are primarily meant to gather feedback, and should not be used in production. Support may be discontinued in the future.

# Phishing attack vulnerablity

## "Getting started" development experience

The redirect pattern used in OAuth 2.0 to enable a web application to access an external service on behalf of a user, also introduces a specific vulnerabilty to phishing attacks. The "getting started" development experience introduced in our [**Using "Token Vault" from an App Service Site**](https://github.com/joerob-msft/app-service-msi-tokenvault-dotnet) topic, introduces a **confirmation dialog** that somewhat mitigates the attack described below, while keeping the initial development experience simple. You can see the "getting started" development sequence below:

![](https://raw.githubusercontent.com/Azure/azure-tokens/master/docs/phishing-attack-vulnerability/development-sequence-diagram.png "Development sequence diagram")

## Attack sequence

For production deployment scenarios however, the developer needs to be fully aware of the details of this attack vulnerability, and take the necessary steps to mitigate it, while keeping the end user experience as easy as possible. The said vunerability has to do with how a malicious user of the web application can phish another unsuspecting user into giving up access to their credentials in an external service. The diagram below uses the well known [Alice, Bob and Mallory](https://en.wikipedia.org/wiki/Alice_and_Bob) personas to demonstrate the attack visually. It is important to note that the attack can occur even if the web application or its developer (Devin) are not compromised.


![](https://raw.githubusercontent.com/Azure/azure-tokens/master/docs/phishing-attack-vulnerability/attack.png "Phishing attack sequence diagram")

## Phishing attack mitigation

To mitigate the attack, the developer of the web application will have to specify and implement a **post-login redirect URI**, which will be responsible for validating that the redirected sequence of pages was indeed initiated from the same session, then explicitly call save for the user's token. The implementation is not trivial and requires understanding the concepts around web application session state, and possibly the parameters passed throughout the redirects. We have provided a sample implementation of this pattern through our [Advanced "Token Vault" for App Service](https://github.com/joerob-msft/app-service-tokenvault-advanced) sample. The diagram below describes the ideal implementaion in general, which elliminates the *confirmation dialog* from the "getting started" development implemenation from the user experience.


![](https://raw.githubusercontent.com/Azure/azure-tokens/master/docs/phishing-attack-vulnerability/production-sequence-diagram.png "Production sequence diagram")
